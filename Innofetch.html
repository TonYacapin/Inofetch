<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyword API Fetcher with CABI Codes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .upload-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .upload-area:hover {
            background: #e9ecef;
            border-color: #764ba2;
        }

        .upload-area i {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        .upload-area h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .upload-area p {
            color: #666;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .file-input {
            display: none;
        }

        .results-section {
            display: none;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .keyword {
            font-weight: bold;
            color: #333;
            font-size: 1.2rem;
        }

        .api-type {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .result-content {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .cabi-codes {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .cabi-codes h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .cabi-code-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 8px;
        }

        .cabi-code {
            font-weight: bold;
            color: #667eea;
            font-family: monospace;
        }

        .cabi-description {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: white;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #c62828;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .no-cabi-codes {
            color: #999;
            font-style: italic;
            text-align: center;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Keyword API Fetcher with CABI Codes</h1>
            <p>Upload a CSV file with keywords to fetch data from CABI APIs and display related CABI Codes</p>
        </div>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <i>üìÅ</i>
                <h3>Upload CSV File</h3>
                <p>Click to upload or drag and drop your CSV file</p>
                <p><small>CSV should contain one keyword per line</small></p>
                <button class="btn" onclick="document.getElementById('fileInput').click()">
                    Choose File
                </button>
                <input type="file" id="fileInput" class="file-input" accept=".csv" onchange="handleFileSelect(event)">
            </div>
            
            <div class="progress-bar" id="progressBar" style="display: none;">
                <div class="progress" id="progress"></div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" id="fetchBtn" onclick="fetchAllData()" disabled>
                    Fetch API Data
                </button>
            </div>
        </div>

        <div class="stats" id="stats" style="display: none;">
            <div class="stat-item">
                <div class="stat-number" id="totalKeywords">0</div>
                <div class="stat-label">Total Keywords</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="completedRequests">0</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="failedRequests">0</div>
                <div class="stat-label">Failed</div>
            </div>
        </div>

        <div class="loading" id="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Fetching API data... Please wait</p>
        </div>

        <div class="results-section" id="resultsSection">
            <h2 style="color: white; margin-bottom: 20px;">API Results with CABI Codes</h2>
            <div class="results-grid" id="resultsGrid"></div>
        </div>
    </div>

    <script>
        // CABI Codes database
        const CABI_CODES = {
            "AA000": "AGRICULTURE (GENERAL) - Agriculture in the broadest sense.",
            "AA500": "RESEARCH - Organization of research, including research policy and strategy, research structure, administration and financing.",
            "BB500": "HISTORY AND BIOGRAPHY - All aspects of human history. Biographies and obituaries.",
            "BB700": "PALAEONTOLOGY AND ARCHAEOLOGY - Including palaeozoology and palaeobotany.",
            "CC000": "EDUCATION, EXTENSION, INFORMATION AND TRAINING (GENERAL)",
            "CC100": "EDUCATION AND TRAINING - Teaching, demonstration, training in subjects covered by the database.",
            "CC200": "EXTENSION AND ADVISORY WORK - Advisory and information services for farmers and rural populations.",
            "CC300": "INFORMATION AND DOCUMENTATION - Information science, information technology and library science.",
            "CC400": "COLLECTIONS - Reference collections of organisms, wood samples etc.",
            "CC700": "PROFESSIONS: PRACTICE AND SERVICE - Career development in professions covered by the database.",
            "DD100": "AGENCIES AND ORGANIZATIONS - Local, state, national and international levels of government and organizations.",
            "DD500": "LAWS AND REGULATIONS - Any law, legislation, legal directive or regulation.",
            "EE100": "ECONOMICS (GENERAL) - General, unapplied economic theory, methodology or analysis.",
            "EE110": "AGRICULTURAL ECONOMICS - All aspects of the economics of agriculture.",
            "EE111": "HORTICULTURAL ECONOMICS - All aspects of the economics of horticultural crops.",
            "EE112": "FORESTRY ECONOMICS - All aspects of forestry economics.",
            "EE113": "AQUACULTURAL AND FISHERIES ECONOMICS - All aspects of fisheries economics.",
            "EE115": "NATURAL RESOURCE ECONOMICS - Environmental and natural resource economics.",
            "EE116": "FOOD ECONOMICS - Food policy, planning and administration for food supply.",
            "EE117": "VETERINARY ECONOMICS - All aspects of veterinary and animal health economics.",
            "EE118": "HEALTH ECONOMICS - All aspects of human health economics.",
            "EE119": "LEISURE, RECREATION AND TOURISM ECONOMICS - Economics of leisure, recreation, tourism.",
            "EE120": "POLICY AND PLANNING - All policy, planning and decision making.",
            "EE125": "AID - International, national development aid programmes and projects.",
            "EE130": "SUPPLY, DEMAND AND PRICES - Supply, demand and price trends for agricultural products.",
            "EE140": "INPUT SUPPLY INDUSTRIES (MACROECONOMICS) - Industries supplying agricultural sectors.",
            "EE145": "INPUT UTILIZATION (MICROECONOMICS) - Local-level usage of agricultural inputs.",
            "EE165": "STRUCTURE, OWNERSHIP AND TENURE - Agricultural structure, land reform.",
            "EE350": "RURAL INDUSTRY AND ENTERPRISES - Programmes for rural industry and enterprises.",
            "EE600": "INTERNATIONAL TRADE - Economic aspects of international trade.",
            "EE700": "MARKETING AND DISTRIBUTION - Marketing and distribution of agricultural products.",
            "EE720": "CONSUMER ECONOMICS - Household and consumer surveys, behaviour, attitudes.",
            "EE800": "INVESTMENT, FINANCE AND CREDIT - Credit policy, financial institutions.",
            "EE900": "LABOUR AND EMPLOYMENT - National policy on employment, working conditions.",
            "EE950": "INCOME AND POVERTY - Poverty alleviation programmes, income studies.",
            "FF000": "PLANT SCIENCE (GENERAL) - General works on botany in relation to agriculture.",
            "FF003": "HORTICULTURAL CROPS - Temperate, subtropical and tropical fruit crops, vegetables.",
            "FF005": "FIELD CROPS - All crops normally grown on a field scale.",
            "FF007": "FORAGE AND FODDER CROPS - All crops grown for cutting or grazing.",
            "FF020": "PLANT BREEDING AND GENETICS - All plants of economic importance.",
            "FF030": "PLANT MORPHOLOGY AND STRUCTURE - Anatomy, cytology, histology of plants.",
            "FF040": "PLANT COMPOSITION - Chemistry and chemical constituents of plants.",
            "FF060": "PLANT PHYSIOLOGY AND BIOCHEMISTRY - Physiology and biochemistry of plants.",
            "FF061": "PLANT NUTRITION - Mineral nutrition of plants and trees.",
            "FF062": "PLANT-WATER RELATIONS - Physiology in relation to water.",
            "FF100": "PLANT PRODUCTION - General plant husbandry, cultivation of plants.",
            "FF150": "PLANT CROPPING SYSTEMS - Cropping systems, alternative farming systems.",
            "FF160": "PLANT PROPAGATION - Plant propagation techniques.",
            "FF170": "IN VITRO CULTURE OF PLANT MATERIAL - in vitro culture of plants.",
            "FF500": "WEEDS AND NOXIOUS PLANTS - Weeds, parasitic plants, poisonous plants.",
            "FF610": "VIRAL, BACTERIAL AND FUNGAL DISEASES OF PLANTS - Pathogens injurious to plants.",
            "FF620": "PLANT PESTS - Pests injurious to plants and their control.",
            "FF700": "PLANT DISORDERS AND INJURIES - Physiological and nutritional disorders.",
            "FF800": "PLANT TOXICOLOGY - Toxicology tests, phytotoxicities.",
            "FF900": "ENVIRONMENTAL TOLERANCE OF PLANTS - Plant hardiness, resistance to extreme conditions.",
            "HH000": "PATHOGEN, PEST AND PARASITE MANAGEMENT (GENERAL) - Control of pathogens and pests.",
            "HH100": "BIOLOGICAL CONTROL - Biological control in its broadest sense.",
            "HH200": "ENVIRONMENTAL PEST MANAGEMENT - Control by rendering environment unsuitable.",
            "HH300": "INTEGRATED PEST MANAGEMENT - Integrated use of control methods.",
            "HH400": "PESTICIDE AND DRUGS (GENERAL) - General works on pesticides and drugs.",
            "HH405": "PESTICIDES AND DRUGS: CONTROL - Use of pesticides or drugs to control pests.",
            "HH410": "PESTICIDE AND DRUG RESISTANCE - Resistance to pesticides and drugs.",
            "HH420": "PESTICIDES AND DRUGS: CHEMISTRY AND FORMULATION - Chemistry of pesticides.",
            "HH430": "PESTICIDE AND DRUG RESIDUES AND ECOTOXICOLOGY - Residues and side effects.",
            "HH500": "REPELLENTS AND ATTRACTANTS - Use in control of pests and parasites.",
            "HH600": "HOST RESISTANCE AND IMMUNITY - Resistance to pests and pathogens.",
            "HH700": "OTHER CONTROL MEASURES - Control by means other than biological, environmental.",
            "JJ000": "SOIL SCIENCE (GENERAL) - General works on soils.",
            "JJ100": "SOIL BIOLOGY - Biological activity in soils by microorganisms.",
            "JJ200": "SOIL CHEMISTRY AND MINERALOGY - Soil chemistry, chemical properties.",
            "JJ300": "SOIL PHYSICS - Soil air, water, structure, temperature.",
            "JJ400": "SOIL MORPHOLOGY, FORMATION AND CLASSIFICATION - Soil classification, types.",
            "JJ500": "SOIL SURVEYS AND LAND EVALUATION - Soil surveying and cartography.",
            "JJ600": "SOIL FERTILITY - Determination of soil fertility, degradation.",
            "JJ700": "FERTILIZERS AND OTHER AMENDMENTS - All fertilizers and soil amendments.",
            "JJ800": "SOIL WATER MANAGEMENT - Irrigation, drainage, water management.",
            "JJ900": "SOIL MANAGEMENT - Tillage, soil cultivation, mulches.",
            "KK000": "FORESTRY, FOREST PRODUCTS AND AGROFORESTRY (GENERAL) - General works.",
            "KK100": "FORESTS AND FOREST TREES (BIOLOGY AND ECOLOGY) - Biology of forest trees.",
            "KK110": "SILVICULTURE AND FOREST MANAGEMENT - Species trials, forest management.",
            "KK130": "FOREST FIRE - Danger, behaviour, prevention, control.",
            "KK160": "ORNAMENTAL AND AMENITY TREES - Ornamental trees, urban forestry.",
            "KK500": "FOREST PRODUCTS AND INDUSTRIES (GENERAL) - General works.",
            "KK510": "WOOD PROPERTIES, DAMAGE AND PRESERVATION - Wood anatomy and chemistry.",
            "KK515": "LOGGING AND WOOD PROCESSING - Forest engineering, timber extraction.",
            "KK520": "WOOD UTILIZATION AND ENGINEERED WOOD PRODUCTS - Wood utilization.",
            "KK530": "CHEMICAL AND BIOLOGICAL PROCESSING OF WOOD - Pulping industry.",
            "KK540": "NON-WOOD FOREST PRODUCTS - Use of wood and forest residues.",
            "KK600": "AGROFORESTRY AND MULTIPURPOSE TREES - Agroforestry systems.",
            "LL000": "ANIMAL SCIENCE (GENERAL) - General works on animal science.",
            "LL010": "APICULTURE - Beekeeping, production of hive products.",
            "LL020": "SERICULTURE - Silkworms and silkmoths.",
            "LL030": "OTHER INVERTEBRATE CULTURE - Rearing/culture of invertebrates.",
            "LL040": "LABORATORY ANIMAL SCIENCE - Husbandry of laboratory animals.",
            "LL050": "GAME ANIMALS - Management and hunting of game animals.",
            "LL060": "DRAUGHT ANIMALS - Husbandry of draught animals.",
            "LL070": "PETS AND COMPANION ANIMALS - Housing and care of pets.",
            "LL075": "SPORT ANIMALS - Racing animals, horses in sports.",
            "LL080": "ZOO ANIMALS - Capture and care of zoo animals.",
            "LL110": "DAIRY ANIMALS - Management of dairy animals.",
            "LL120": "MEAT-PRODUCING ANIMALS - Management of animals for meat production.",
            "LL130": "EGG-PRODUCING ANIMALS - Management of birds for egg production.",
            "LL145": "WOOL-PRODUCING ANIMALS - Management for wool production.",
            "LL148": "FUR-BEARING ANIMALS - Management for fur production.",
            "LL180": "ANIMAL HUSBANDRY AND PRODUCTION - Husbandry of farm animals.",
            "LL190": "ANIMAL SLAUGHTER - Slaughter of livestock.",
            "LL240": "ANIMAL GENETICS AND BREEDING - Breeding and genetics of animals.",
            "LL250": "ANIMAL REPRODUCTION AND EMBRYOLOGY - Reproduction and embryology.",
            "LL300": "ANIMAL BEHAVIOUR - Behaviour of domesticated animals.",
            "LL400": "ANIMAL ANATOMY AND MORPHOLOGY - Anatomy and morphology.",
            "LL500": "ANIMAL NUTRITION (GENERAL) - Feeding requirements and diets.",
            "LL510": "ANIMAL NUTRITION (PHYSIOLOGY) - Biochemistry and physiology of nutrients.",
            "LL520": "ANIMAL NUTRITION (PRODUCTION RESPONSES) - Production responses to feeding.",
            "LL600": "ANIMAL PHYSIOLOGY AND BIOCHEMISTRY - Physiology and biochemistry.",
            "LL650": "ANIMAL IMMUNOLOGY - Immunology of domesticated animals.",
            "LL700": "ANIMAL TISSUE AND CELL CULTURE - in vitro culture of animal tissue.",
            "LL800": "ANIMAL HEALTH AND HYGIENE (GENERAL) - General veterinary medicine.",
            "LL810": "ANIMAL WELFARE - Welfare of domesticated animals.",
            "LL821": "PRION, VIRAL, BACTERIAL AND FUNGAL PATHOGENS OF ANIMALS - Diseases caused by pathogens.",
            "LL822": "PROTOZOAN, HELMINTH, MOLLUSC AND ARTHROPOD PARASITES OF ANIMALS - Parasites.",
            "LL823": "VETERINARY PESTS, VECTORS AND INTERMEDIATE HOSTS - Disease vectors.",
            "LL860": "NON-COMMUNICABLE DISEASES AND INJURIES OF ANIMALS - Injuries and disorders.",
            "LL882": "VETERINARY PHARMACOLOGY AND ANAESTHESIOLOGY - Pharmacology of veterinary drugs.",
            "LL884": "ANIMAL SURGERY AND NON-DRUG THERAPY - Surgery and non-drug therapy.",
            "LL886": "DIAGNOSIS OF ANIMAL DISEASES - Diagnosis and diagnostic techniques.",
            "LL950": "TOXICOLOGY AND POISONING OF ANIMALS - Veterinary toxicology.",
            "MM000": "AQUATIC SCIENCES (GENERAL) - General aspects of aquatic sciences.",
            "MM110": "FISHERIES - Methods and equipment for fishing.",
            "MM120": "AQUACULTURE (ANIMALS) - Production of marine and freshwater animals.",
            "MM130": "AQUACULTURE (PLANTS) - Culture of algae and aquatic plants.",
            "MM300": "AQUATIC BIOLOGY AND ECOLOGY - Biology and ecology of aquatic life.",
            "NN000": "ENGINEERING AND EQUIPMENT (GENERAL) - General works.",
            "NN050": "AUTOMATION AND CONTROL - Computer and electronic control systems.",
            "NN300": "FARM AND HORTICULTURAL STRUCTURES - Design of animal housing, greenhouses.",
            "NN400": "AGRICULTURAL AND FORESTRY EQUIPMENT - Design and use of equipment.",
            "NN460": "CLEANING, GRADING, HANDLING, STORAGE AND TRANSPORT EQUIPMENT - Handling equipment.",
            "NN600": "PROCESSING EQUIPMENT AND TECHNOLOGY - Equipment for processing products.",
            "PP000": "NATURAL RESOURCES (GENERAL) - General works on natural resources.",
            "PP100": "ENERGY - All energy sources, production and consumption.",
            "PP200": "WATER RESOURCES - Management and use of water resources.",
            "PP300": "LAND RESOURCES - Land types, landscapes, land management.",
            "PP320": "WETLANDS - Ecology and conservation of wetlands.",
            "PP350": "GRASSLANDS AND RANGELANDS - Ecology and management of grasslands.",
            "PP400": "EROSION; SOIL AND WATER CONSERVATION - Soil erosion and conservation.",
            "PP500": "METEOROLOGY AND CLIMATE - Air and atmosphere, climate.",
            "PP600": "POLLUTION AND DEGRADATION - Air, soil, and water pollution.",
            "PP700": "BIOLOGICAL RESOURCES (GENERAL) - Natural populations as resources.",
            "PP710": "BIOLOGICAL RESOURCES (ANIMAL) - Biogeography of animals.",
            "PP720": "BIOLOGICAL RESOURCES (PLANT) - Biogeography of plants.",
            "PP800": "NATURAL DISASTERS - Natural climatic and geological phenomena.",
            "QQ000": "FOOD SCIENCE AND FOOD PRODUCTS (HUMAN) - General food science.",
            "QQ010": "MILK AND DAIRY PRODUCE - Dairy products and processing.",
            "QQ020": "SUGAR AND SUGAR PRODUCTS - Sugar and sugar products.",
            "QQ030": "MEAT PRODUCE - Meat products and processing.",
            "QQ040": "EGGS AND EGG PRODUCTS - Poultry products.",
            "QQ050": "CROP PRODUCE - Edible crop products.",
            "QQ060": "AQUATIC PRODUCE - Aquatic products.",
            "QQ070": "OTHER PRODUCE - Other terrestrial edible products.",
            "QQ100": "FOOD PROCESSING (GENERAL) - General food processing technologies.",
            "QQ110": "FOOD STORAGE AND PRESERVATION - Methods of storing food.",
            "QQ111": "STORAGE PROBLEMS AND PESTS OF FOOD - Infection and infestation.",
            "QQ120": "MICROBIAL TECHNOLOGY IN FOOD PROCESSING - Use of microorganisms.",
            "QQ130": "FOOD ADDITIVES - Colorants, flavourings, preservatives.",
            "QQ200": "FOOD CONTAMINATION, RESIDUES AND TOXICOLOGY - Food safety.",
            "QQ500": "FOOD COMPOSITION AND QUALITY - Quality and properties of food.",
            "RR000": "FORAGE AND FEED PRODUCTS (NON-HUMAN) - Feed science and products.",
            "RR100": "FORAGE AND FEED PROCESSING - Processing and storage of feeds.",
            "RR130": "FEED ADDITIVES - Feed additives and growth promoters.",
            "RR200": "FEED CONTAMINATION, RESIDUES AND TOXICOLOGY - Contamination of feeds.",
            "RR300": "FEED COMPOSITION AND QUALITY - Chemical composition of feedstuffs.",
            "SS000": "NON-FOOD/NON-FEED AGRICULTURAL PRODUCTS (GENERAL) - General works.",
            "SS100": "NON-FOOD/NON-FEED ANIMAL PRODUCTS - Processing of animal products.",
            "SS200": "NON-FOOD/NON-FEED PLANT PRODUCTS - Processing of plant products.",
            "SS210": "STORAGE PROBLEMS AND PESTS OF NON-FOOD/NON-FEED PLANT PRODUCTS - Pests and damage.",
            "SS230": "COMPOSITION AND QUALITY OF NON-FOOD/NON-FEED PLANT PRODUCTS - Constituents and composition.",
            "SS300": "BIODETERIORATION - Deterioration caused by pests and microorganisms.",
            "UU000": "SOCIAL SCIENCES (GENERAL) - General works on social sciences.",
            "UU100": "HOUSING AND SETTLEMENT - Housing policies and programmes.",
            "UU200": "DEMOGRAPHY - Human population studies.",
            "UU300": "PUBLIC SERVICES AND INFRASTRUCTURE - Planning of public services.",
            "UU350": "HEALTH SERVICES - Health services and medical provision.",
            "UU360": "COMMUNICATION AND MASS MEDIA - Telecommunications and mass media.",
            "UU450": "COMMUNITY PARTICIPATION AND DEVELOPMENT - Community involvement.",
            "UU485": "SOCIAL PSYCHOLOGY AND SOCIAL ANTHROPOLOGY - Social structure and attitudes.",
            "UU495": "CONFLICT - War, social tension and aggression.",
            "UU500": "WOMEN - Studies focused on women in society.",
            "UU600": "LEISURE - Leisure and its relation to work.",
            "UU610": "RECREATIONAL FACILITIES AND MANAGEMENT - Provision of leisure opportunities.",
            "UU625": "SPORT AND RECREATIONAL ACTIVITIES - Sport and recreational activities.",
            "UU630": "ARTS, ENTERTAINMENT AND CULTURAL HERITAGE - Arts and entertainment.",
            "UU700": "TOURISM AND TRAVEL - All types of tourism.",
            "UU800": "RURAL SOCIOLOGY - All aspects of rural sociology.",
            "UU850": "RURAL DEVELOPMENT - Improvement in quality of rural life.",
            "VV000": "HUMAN HEALTH AND HYGIENE (GENERAL) - General works on medicine.",
            "VV050": "HUMAN PHYSIOLOGY AND BIOCHEMISTRY - Physiology and biochemistry.",
            "VV055": "HUMAN IMMUNOLOGY AND ALLERGOLOGY - Immunology and allergies.",
            "VV060": "HUMAN REPRODUCTION AND DEVELOPMENT - Reproductive physiology.",
            "VV065": "HUMAN SEXUAL AND REPRODUCTIVE HEALTH - Sexual and reproductive health.",
            "VV100": "HUMAN NUTRITION (GENERAL) - General studies of human nutrition.",
            "VV110": "DIET STUDIES - Dietary surveys and food consumption.",
            "VV120": "PHYSIOLOGY OF HUMAN NUTRITION - Physiology and metabolism of nutrients.",
            "VV130": "NUTRITION RELATED DISORDERS AND THERAPEUTIC NUTRITION - Nutritional diseases.",
            "VV140": "ANIMAL MODELS OF HUMAN NUTRITION - Animal research related to nutrition.",
            "VV210": "PRION, VIRAL, BACTERIAL AND FUNGAL PATHOGENS OF HUMANS - Human diseases.",
            "VV220": "PROTOZOAN, HELMINTH AND ARTHROPOD PARASITES OF HUMANS - Human parasites.",
            "VV230": "PUBLIC HEALTH PESTS, VECTORS AND INTERMEDIATE HOSTS - Disease vectors.",
            "VV400": "ANIMAL MODELS OF HUMAN DISEASES - Human diseases studied in animals.",
            "VV450": "ANIMAL AND IN VITRO MODELS FOR PHARMACEUTICALS - Drug testing.",
            "VV500": "HUMAN HEALTH AND THE ENVIRONMENT - Diseases caused by environmental factors.",
            "VV550": "RURAL HEALTH - Human health with rural emphasis.",
            "VV600": "NON-COMMUNICABLE DISEASES AND INJURIES - Disorders with non-infectious cause.",
            "VV710": "NON-DRUG THERAPY OF HUMANS - Non-drug therapy for human health.",
            "VV720": "DIAGNOSIS OF HUMAN DISEASE - Clinical and laboratory diagnosis.",
            "VV730": "PHARMACOLOGY - Pharmacokinetics and pharmacodynamics.",
            "VV810": "TOXICOLOGY AND POISONING - Substances toxic to humans.",
            "VV820": "TOXINOLOGY - Substances produced by organisms toxic to man.",
            "VV900": "OCCUPATIONAL HEALTH AND SAFETY - Occupational safety and hygiene.",
            "WW000": "BIOTECHNOLOGY - Application of molecular genetics.",
            "XX000": "WASTES (GENERAL) - General works on wastes.",
            "XX100": "ANIMAL WASTES - Wastes from animals and processing.",
            "XX200": "PLANT WASTES - Wastes from plant production.",
            "XX300": "HUMAN WASTES AND REFUSE - Wastes produced by humans.",
            "XX400": "INDUSTRIAL WASTES AND EFFLUENTS - Wastes from industrial activity.",
            "XX700": "BIODEGRADATION - Biodegradation processes.",
            "YY000": "ZOOLOGY - WILD ANIMALS (GENERAL) - General biology of non-domestic animals.",
            "YY100": "ANATOMY AND MORPHOLOGY (WILD ANIMALS) - Anatomy of non-domestic animals.",
            "YY200": "REPRODUCTION, DEVELOPMENT AND LIFE CYCLE (WILD ANIMALS) - Reproduction and growth.",
            "YY300": "GENETICS AND MOLECULAR GENETICS (WILD ANIMALS) - Genetics of non-domestic animals.",
            "YY400": "PHYSIOLOGY AND BIOCHEMISTRY (WILD ANIMALS) - Physiology and biochemistry.",
            "YY500": "BEHAVIOUR (WILD ANIMALS) - Behaviour of non-domestic animals.",
            "YY700": "PATHOGENS, PARASITES AND INFECTIOUS DISEASES (WILD ANIMALS) - Infectious diseases.",
            "YY800": "OTHER WILDLIFE DISEASES - Non-infectious diseases of non-domestic animals.",
            "YY900": "TOXICOLOGY AND POISONING (WILD ANIMALS) - Toxic substances and their effects.",
            "ZZ000": "OTHER SCIENCES - Use specific codes.",
            "ZZ100": "MATHEMATICS AND STATISTICS - Statistical methods and models.",
            "ZZ200": "MATERIALS SCIENCE - Physical and mechanical properties of materials.",
            "ZZ300": "LIFE SCIENCES (GENERAL) - General life sciences and biology.",
            "ZZ330": "ECOLOGY (GENERAL) - General and theoretical ecology.",
            "ZZ331": "PLANT ECOLOGY - Ecology of terrestrial plants.",
            "ZZ332": "ANIMAL ECOLOGY - Ecology of terrestrial animals.",
            "ZZ333": "MICROBIAL ECOLOGY - Ecology of microorganisms.",
            "ZZ380": "TAXONOMY AND EVOLUTION - Classification and evolution.",
            "ZZ390": "MICROBIOLOGY (GENERAL) - General biology of microorganisms.",
            "ZZ392": "MORPHOLOGY OF MICROORGANISMS - Morphology of microorganisms.",
            "ZZ394": "BIOCHEMISTRY AND PHYSIOLOGY OF MICROORGANISMS - Biochemistry of microorganisms.",
            "ZZ395": "GENETICS AND MOLECULAR GENETICS OF MICROORGANISMS - Genetics of microorganisms.",
            "ZZ396": "MICROBIAL LIFE CYCLES - Life cycles of microorganisms.",
            "ZZ500": "PHYSICAL SCIENCES (GENERAL) - General works on physics and chemistry.",
            "ZZ700": "FORENSIC SCIENCE - Application of science in legal investigation.",
            "ZZ800": "GEOLOGY AND GEOMORPHOLOGY (GENERAL) - Geology, mineralogy, seismology.",
            "ZZ900": "TECHNIQUES AND METHODOLOGY - Investigative and analytical techniques."
        };

        let keywords = [];
        let results = [];

        // Handle file selection
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const csvContent = e.target.result;
                        keywords = csvContent.split('\n')
                            .map(line => line.trim())
                            .filter(line => line.length > 0)
                            .filter((line, index, self) => self.indexOf(line) === index);
                        
                        document.getElementById('fetchBtn').disabled = false;
                        document.getElementById('uploadArea').innerHTML = `
                            <i>‚úÖ</i>
                            <h3>File Loaded Successfully</h3>
                            <p>${keywords.length} unique keywords found</p>
                            <p><strong>File:</strong> ${file.name}</p>
                            <button class="btn" onclick="document.getElementById('fileInput').click()">
                                Choose Different File
                            </button>
                        `;
                    } catch (error) {
                        alert('Error reading CSV file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        }

        // Drag and drop functionality
        const uploadArea = document.getElementById('uploadArea');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.background = '#e9ecef';
            uploadArea.style.borderColor = '#764ba2';
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.style.background = '#f8f9fa';
            uploadArea.style.borderColor = '#667eea';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.background = '#f8f9fa';
            uploadArea.style.borderColor = '#667eea';
            
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'text/csv') {
                const input = document.getElementById('fileInput');
                input.files = e.dataTransfer.files;
                handleFileSelect({ target: input });
            } else {
                alert('Please drop a CSV file');
            }
        });

        // API endpoints
        const API_ENDPOINTS = [
            { name: 'Main Table', url: 'https://cabi-inference2.innodata.com/cabnpweb/api/get-main-by-term?term=' },
            { name: 'Non-Thesaurus', url: 'https://cabi-inference2.innodata.com/cabnpweb/api/search-non-thesaurus?term=' },
            { name: 'LookUp Table', url: 'https://cabi-inference2.innodata.com/cabnpweb/api/get-main-by-term?term=' }
        ];

        // Fetch data from a single API
        async function fetchApiData(keyword, api) {
            try {
                const response = await fetch(api.url + encodeURIComponent(keyword));
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return { success: true, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // Find relevant CABI codes for a keyword
        function findRelevantCabiCodes(keyword) {
            const relevantCodes = [];
            const lowerKeyword = keyword.toLowerCase();
            
            for (const [code, description] of Object.entries(CABI_CODES)) {
                const lowerDescription = description.toLowerCase();
                if (lowerDescription.includes(lowerKeyword) || 
                    code.toLowerCase().includes(lowerKeyword.replace(/\s+/g, ''))) {
                    relevantCodes.push({ code, description });
                }
            }
            
            return relevantCodes.slice(0, 5); // Return top 5 most relevant codes
        }

        // Fetch all data for all keywords
        async function fetchAllData() {
            if (keywords.length === 0) {
                alert('Please upload a CSV file first');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('stats').style.display = 'flex';
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('fetchBtn').disabled = true;

            results = [];
            const totalRequests = keywords.length * API_ENDPOINTS.length;
            let completedRequests = 0;
            let failedRequests = 0;

            document.getElementById('totalKeywords').textContent = keywords.length;
            document.getElementById('completedRequests').textContent = completedRequests;
            document.getElementById('failedRequests').textContent = failedRequests;

            document.getElementById('progressBar').style.display = 'block';

            for (let i = 0; i < keywords.length; i++) {
                const keyword = keywords[i];
                const keywordResults = {
                    keyword: keyword,
                    apis: [],
                    cabiCodes: findRelevantCabiCodes(keyword)
                };

                for (let j = 0; j < API_ENDPOINTS.length; j++) {
                    const api = API_ENDPOINTS[j];
                    const result = await fetchApiData(keyword, api);
                    
                    keywordResults.apis.push({
                        name: api.name,
                        ...result
                    });

                    completedRequests++;
                    if (!result.success) {
                        failedRequests++;
                    }

                    // Update progress
                    const progress = (completedRequests / totalRequests) * 100;
                    document.getElementById('progress').style.width = progress + '%';
                    document.getElementById('completedRequests').textContent = completedRequests;
                    document.getElementById('failedRequests').textContent = failedRequests;
                }

                results.push(keywordResults);
                displayResults();
            }

            document.getElementById('loading').style.display = 'none';
            document.getElementById('fetchBtn').disabled = false;
        }

        // Display results in the UI
        function displayResults() {
            const resultsGrid = document.getElementById('resultsGrid');
            resultsGrid.innerHTML = '';

            results.forEach(keywordResult => {
                const card = document.createElement('div');
                card.className = 'result-card';
                
                let cardContent = `
                    <div class="result-header">
                        <div class="keyword">${keywordResult.keyword}</div>
                    </div>
                `;

                // Display API results
                keywordResult.apis.forEach(apiResult => {
                    cardContent += `
                        <div class="api-result">
                            <div class="api-type">${apiResult.name}</div>
                            <div class="result-content">
                    `;

                    if (apiResult.success) {
                        cardContent += `<pre>${JSON.stringify(apiResult.data, null, 2)}</pre>`;
                    } else {
                        cardContent += `<div class="error">Error: ${apiResult.error}</div>`;
                    }

                    cardContent += `
                            </div>
                        </div>
                        <hr style="margin: 10px 0; border: none; border-top: 1px solid #f0f0f0;">
                    `;
                });

                // Display CABI Codes
                cardContent += `
                    <div class="cabi-codes">
                        <h4>Relevant CABI Codes:</h4>
                `;

                if (keywordResult.cabiCodes.length > 0) {
                    keywordResult.cabiCodes.forEach(cabiCode => {
                        cardContent += `
                            <div class="cabi-code-item">
                                <div class="cabi-code">${cabiCode.code}</div>
                                <div class="cabi-description">${cabiCode.description}</div>
                            </div>
                        `;
                    });
                } else {
                    cardContent += `<div class="no-cabi-codes">No relevant CABI codes found</div>`;
                }

                cardContent += `</div>`;

                card.innerHTML = cardContent;
                resultsGrid.appendChild(card);
            });
        }

        // Download CSV template function
        function downloadCSV() {
            const csvContent = `Waste lipids
Primary sewage sludge
Activated sewage sludge
PASS
Co-digestion
Biogas production
Wastewater treatment plants
Long-chain fatty acids
LCFA
Anaerobic digestion
AD
Sulfide level
Microbial communities
Oleate
Stearate
Acetate
Acetoclastic methanogenesis
Biogas formation
16S rRNA gene amplicons
Next-generation sequencing
Taxonomic profiling
Cloacimonetes
Cloacimonadaceae
W5
W27
Cloacimonadales
Syntrophomonas
Smithella
Methanobacterium
Hydrogenotrophic methanogenesis
LCFA degradation
LCFA accumulation
Batch-mode digestion
Continuous co-digestion
Theoretical biogas potential
Microbial community dynamics
Municipal sludge digesters`;

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', 'anaerobic_digestion_keywords.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
</body>
</html>